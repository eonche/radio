<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <!-- iPad 3rd gen rezolucija je 2048x1536 (Retina). Standardni viewport je kljucan. -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Noćni Radio Plejer (Lite)</title>
    <style>
        /* Osnovni stilovi za kompatibilnost sa starim Safari/WebKit brauzerima */
        body {
            font-family: Arial, Helvetica, sans-serif; /* Koristimo sistemske fontove */
            background-color: #111111;
            color: #ffffff;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        /* Glavni kontejner fiksne sirine za jednostavan raspored */
        #main-container {
            width: 90%;
            max-width: 800px;
            margin: 0 auto;
            background-color: #222222;
            border: 1px solid #333333;
            padding: 10px;
            overflow: hidden; /* Za float elemente */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        /* Paneli (Leva i Desna strana) */
        #left-panel, #right-panel {
            float: left;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
        }

        /* Postavljamo na 50% za sire ekrane */
        @media only screen and (min-width: 600px) {
            #left-panel, #right-panel {
                width: 50%;
            }
        }
        
        /* Stilizacija stanice (placeholder slike) */
        #station-art {
            width: 150px;
            height: 150px;
            background-color: #444444;
            display: block;
            margin: 10px auto 20px auto;
            border: 5px solid #0099cc; /* Osnovna akcentna boja */
        }
        
        #station-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 5px;
        }

        #station-genre {
            font-size: 0.9em;
            color: #aaaaaa;
            margin-bottom: 15px;
        }

        /* Stilovi za dugmad i kontrole */
        button {
            cursor: pointer;
            background-color: #007799;
            color: #ffffff;
            border: none;
            padding: 10px 15px;
            margin: 5px 0;
            width: 100%;
            font-size: 1em;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        button:hover {
            background-color: #0099cc;
        }
        
        /* Timer Layout */
        #timer-controls {
            padding-top: 10px;
            border-top: 1px solid #333333;
            margin-top: 20px;
        }
        .timer-grid {
            display: block; /* Uklanjamo flex/grid za starije preglednike */
        }
        .timer-grid button {
            width: 48%;
            margin: 1%;
            float: left;
            padding: 8px 0;
            font-size: 0.9em;
            background-color: #333333;
        }
        .timer-grid button:nth-child(even) {
            margin-right: 0;
        }
        .timer-grid button:nth-child(odd) {
             margin-left: 0;
        }
        
        /* Timer Status */
        #timer-status {
            color: #aaaaaa;
            font-size: 0.9em;
            text-align: center;
            margin-bottom: 10px;
        }
        
        #cancel-timer-btn {
            background-color: #cc0000;
            width: auto;
            padding: 5px 10px;
            font-size: 0.8em;
            display: inline-block;
            float: none;
        }
        
        /* Lista stanica */
        #station-list-container {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: scroll;
            padding-right: 10px;
        }
        
        .station-item {
            background-color: #333333;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            text-align: left;
            overflow: hidden; /* Za float unutar itema */
        }
        
        .station-item:hover {
            background-color: #444444;
        }
        
        .station-art-small {
            float: left;
            width: 40px;
            height: 40px;
            margin-right: 10px;
            background-color: #555555;
            display: block;
        }
        
        .station-info {
            float: left;
            width: 70%;
        }
        
        .station-info p:first-child {
            font-weight: bold;
            color: #e0e0e0;
        }
        
        .station-info p:last-child {
            font-size: 0.8em;
            color: #aaaaaa;
        }
        
        /* Stanica koja se trenutno reprodukuje */
        .selected-station {
            background-color: #0099cc !important;
            color: #ffffff;
        }
        .selected-station .station-info p {
            color: #ffffff;
        }
        
        /* Vizualizator - veoma pojednostavljen */
        #visualizer-container {
            height: 50px;
            margin: 15px 0;
            text-align: center;
        }
        .visualizer-bar {
            width: 5px;
            height: 10px;
            background-color: #0099cc;
            display: inline-block;
            margin: 0 2px;
            -webkit-animation: quiet 1.5s ease-in-out infinite;
            animation: quiet 1.5s ease-in-out infinite;
        }
        
        .playing .visualizer-bar {
            -webkit-animation-name: pulse;
            animation-name: pulse;
        }

        /* Prefix-i za stariji WebKit (iPad 3) */
        @-webkit-keyframes pulse {
            0%, 100% { height: 10px; opacity: 0.7; }
            50% { height: 40px; opacity: 1; }
        }
        @-webkit-keyframes quiet {
            0%, 100% { -webkit-transform: scaleY(1); }
            50% { -webkit-transform: scaleY(0.4); }
        }
        
        @keyframes pulse {
            0%, 100% { height: 10px; opacity: 0.7; }
            50% { height: 40px; opacity: 1; }
        }
        @keyframes quiet {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.4); }
        }
        
        .hidden {
            display: none !important;
        }

        /* Cistimo float-ove */
        .clearfix:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
</head>
<body>

    <!-- Glavni Kontejner Aplikacije -->
    <div id="main-container">
        
        <!-- Leva Strana: Plejer i Kontrole -->
        <div id="left-panel">
            <header style="margin-bottom: 20px;">
                <h1 style="font-size: 2em; color: #0099cc; margin-bottom: 5px;">Noćni Radio</h1>
                <p style="font-size: 0.9em; color: #aaaaaa;">Lagana verzija sa tajmerom</p>
            </header>

            <!-- Art/Placeholder -->
            <img id="station-art" src="https://placehold.co/150x150/111111/cccccc?text=Dobro+Dosli" alt="Slika Stanice">

            <!-- Trenutna Reprodukcija -->
            <div id="now-playing">
                <h2 id="station-name">Izaberite Stanicu</h2>
                <p id="station-genre">Trenutno se ništa ne reprodukuje</p>
            </div>
            
            <!-- Vizualizator -->
            <div id="visualizer-container">
                <div class="visualizer-bar"></div>
                <div class="visualizer-bar" style="-webkit-animation-delay: 0.2s; animation-delay: 0.2s;"></div>
                <div class="visualizer-bar" style="-webkit-animation-delay: 0.4s; animation-delay: 0.4s;"></div>
                <div class="visualizer-bar" style="-webkit-animation-delay: 0.6s; animation-delay: 0.6s;"></div>
                <div class="visualizer-bar" style="-webkit-animation-delay: 0.8s; animation-delay: 0.8s;"></div>
            </div>

            <!-- Kontrole Plejera -->
            <div>
                 <!-- Dugme za Pokretanje/Pauzu -->
                <button id="play-pause-btn">
                    <span id="play-pause-text">POKRENI</span>
                </button>

                <!-- Tajmer za Spavanje -->
                <div id="timer-controls">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <p id="timer-status">Tajmer za Spavanje</p>
                        <button id="cancel-timer-btn" class="hidden" style="margin: 5px auto 0; width: 100px;">Poništi</button>
                    </div>
                    <div class="timer-grid clearfix">
                        <button class="timer-btn" data-minutes="15">15 min</button>
                        <button class="timer-btn" data-minutes="30">30 min</button>
                        <button class="timer-btn" data-minutes="45">45 min</button>
                        <button class="timer-btn" data-minutes="60">60 min</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desna Strana: Lista Stanica -->
        <div id="right-panel">
            <h3 style="font-size: 1.2em; margin-bottom: 10px; color: #e0e0e0;">Dostupne Stanice</h3>
            <div id="station-list-container">
                <div id="station-list">
                    <!-- Stanice ce biti dinamicki umetnute ovde -->
                </div>
            </div>
        </div>
    </div>

    <!-- Sam Audio Element (Skriven) -->
    <audio id="audio-player" crossorigin="anonymous"></audio>

    <script>
        // Osiguravamo da se kod pokrece tek nakon ucitavanja DOM-a
        document.addEventListener('DOMContentLoaded', function() {
            
            // DOM elementi
            var audioPlayer = document.getElementById('audio-player');
            var playPauseBtn = document.getElementById('play-pause-btn');
            var playPauseText = document.getElementById('play-pause-text');
            var stationList = document.getElementById('station-list');
            var stationArt = document.getElementById('station-art');
            var stationNameEl = document.getElementById('station-name');
            var stationGenreEl = document.getElementById('station-genre');
            var visualizerContainer = document.getElementById('visualizer-container');
            var timerButtons = document.querySelectorAll('.timer-btn');
            var cancelTimerBtn = document.getElementById('cancel-timer-btn');
            var timerStatusEl = document.getElementById('timer-status');

            // Radio Stanice (isti podaci kao u originalu)
            var stations = [
                {
                    name: "ROCK Radio Beograd",
                    genre: "Tvoj zivot - tvoja muzika",
                    url: "https://edge9.pink.rs/rockstream",
                    art: "https://placehold.co/40x40/4338ca/ffffff?text=R"
                },
                {
                    name: "Lush (SomaFM)",
                    genre: "Downtempo & Lofi",
                    url: "https://ice1.somafm.com/lush-128-mp3",
                    art: "https://placehold.co/40x40/7c3aed/ffffff?text=L"
                },
                {
                    name: "DEF CON Radio (SomaFM)",
                    genre: "Electronic & Hacking Culture",
                    url: "https://ice1.somafm.com/defcon-128-mp3",
                    art: "https://placehold.co/40x40/b91c1c/ffffff?text=D"
                },
                {
                    name: "Radio Paradise",
                    genre: "Eclectic Rock Mix",
                    url: "https://stream.radioparadise.com/mp3-192",
                    art: "https://placehold.co/40x40/047857/ffffff?text=P"
                },
                 {
                    name: "Radio Swiss Jazz",
                    genre: "Classic & Modern Jazz",
                    url: "https://stream.srg-ssr.ch/m/rsj/mp3_128",
                    art: "https://placehold.co/40x40/be123c/ffffff?text=J"
                },
                {
                    name: "Radio Swiss Classic",
                    genre: "Classical Music",
                    url: "https://stream.srg-ssr.ch/m/rsc_de/mp3_128",
                    art: "https://placehold.co/40x40/9a3412/ffffff?text=C"
                },
                {
                    name: "NTS Radio",
                    genre: "Underground & Alternative",
                    url: "https://stream-relay-geo.ntslive.net/stream",
                    art: "https://placehold.co/40x40/4338ca/ffffff?text=N"
                }
            ];

            var currentStationIndex = -1;
            var isPlaying = false;
            var sleepTimerID = null;
            var countdownIntervalID = null;

            // --- UI Funkcije (Pojednostavljene) ---
            
            function updatePlayPauseUI(playing) {
                isPlaying = playing;
                playPauseText.textContent = playing ? 'PAUZIRAJ' : 'POKRENI';
                
                // Kontrola vizualizatora
                if (playing) {
                    visualizerContainer.className = 'playing';
                } else {
                    visualizerContainer.className = '';
                }
            }
            
            function updateStationUI(index) {
                var station = stations[index];
                stationNameEl.textContent = station.name;
                stationGenreEl.textContent = station.genre;
                
                // Placeholder slika za veliku grafiku (station-art)
                // Koristimo boju iz art URL-a kao pozadinu
                var artColor = station.art.split('/')[4].substring(0, 6); 
                stationArt.src = 'https://placehold.co/150x150/' + artColor + '/ffffff?text=' + station.name.substring(0, 1);

                // Azuriranje selekcije u listi stanica
                var items = stationList.querySelectorAll('.station-item');
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    if (i === index) {
                        item.className = 'station-item selected-station clearfix';
                    } else {
                        item.className = 'station-item clearfix';
                    }
                }
            }

            // --- Logika Plejera ---

            function playStation(index) {
                if (index === currentStationIndex && isPlaying) return;

                audioPlayer.pause();
                audioPlayer.src = '';
                audioPlayer.load();

                // Prikazujemo status ucitavanja
                stationNameEl.textContent = "Povezivanje...";
                stationGenreEl.textContent = stations[index].name;
                currentStationIndex = index;
                audioPlayer.src = stations[index].url;
                
                // Pokretanje reprodukcije
                var playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    // Stariji brauzeri mogu zahtevati direktno play() poziv bez Promise-a
                    playPromise.then(function() {
                        updatePlayPauseUI(true);
                        updateStationUI(index);
                    }).catch(function(error) {
                        // Ako play() ne uspe (npr. zbog autoplay pravila)
                        console.error("Greska pri reprodukciji audio zapisa:", error);
                        stationNameEl.textContent = "Greska pri Ucitavanju Stanice";
                        stationGenreEl.textContent = "Pokušajte ponovo.";
                        updatePlayPauseUI(false);
                        currentStationIndex = -1;
                    });
                } else {
                     // Fallback za starije browsere koji ne podržavaju play Promise
                    try {
                        audioPlayer.play();
                        updatePlayPauseUI(true);
                        updateStationUI(index);
                    } catch (e) {
                         console.error("Greska pri reprodukciji audio zapisa (fallback):", e);
                        stationNameEl.textContent = "Greska pri Ucitavanju Stanice";
                        stationGenreEl.textContent = "Pokušajte ponovo.";
                        updatePlayPauseUI(false);
                        currentStationIndex = -1;
                    }
                }
            }

            function togglePlayPause() {
                if (currentStationIndex === -1) {
                    // Ako nista nije izabrano, pokreni prvu stanicu
                    playStation(0);
                } else {
                    if (audioPlayer.paused) {
                        audioPlayer.play();
                    } else {
                        audioPlayer.pause();
                    }
                }
            }
            
            // --- Logika Tajmera ---
            
            function pad(num) {
                return num < 10 ? '0' + num : String(num);
            }
            
            function cancelTimer() {
                clearTimeout(sleepTimerID);
                clearInterval(countdownIntervalID);
                sleepTimerID = null;
                countdownIntervalID = null;
                
                timerStatusEl.textContent = "Tajmer za Spavanje";
                cancelTimerBtn.className = 'hidden';
                
                // Uklanjanje selekcije sa dugmadi tajmera
                for (var i = 0; i < timerButtons.length; i++) {
                    var btn = timerButtons[i];
                    btn.style.backgroundColor = '#333333';
                }
            }
            
            function startTimer(minutes) {
                cancelTimer();

                var endTime = Date.now() + minutes * 60 * 1000;

                sleepTimerID = setTimeout(function() {
                    audioPlayer.pause();
                    cancelTimer();
                    updatePlayPauseUI(false);
                }, minutes * 60 * 1000);

                countdownIntervalID = setInterval(function() {
                    var remaining = endTime - Date.now();
                    if (remaining <= 0) {
                        clearInterval(countdownIntervalID);
                        return;
                    }
                    var remainingMinutes = Math.floor((remaining / 1000) / 60);
                    var remainingSeconds = Math.floor((remaining / 1000) % 60);
                    timerStatusEl.textContent = 'Zaustavlja se za: ' + pad(remainingMinutes) + ':' + pad(remainingSeconds);
                }, 1000);
                
                cancelTimerBtn.className = '';
                
                // Oznacavanje izabranog tajmera
                for (var i = 0; i < timerButtons.length; i++) {
                    var btn = timerButtons[i];
                    var btnMinutes = parseInt(btn.getAttribute('data-minutes'), 10);
                    if (btnMinutes === minutes) {
                        btn.style.backgroundColor = '#0099cc';
                    } else {
                        btn.style.backgroundColor = '#333333';
                    }
                }
            }

            // --- Event Listeners (koristimo standardne metode) ---

            playPauseBtn.addEventListener('click', togglePlayPause);
            audioPlayer.addEventListener('play', function() { updatePlayPauseUI(true); });
            audioPlayer.addEventListener('pause', function() { updatePlayPauseUI(false); });
            audioPlayer.addEventListener('ended', function() { updatePlayPauseUI(false); });
            audioPlayer.addEventListener('error', function(e) {
                console.error("Greska Audio Plejera:", e);
                if (audioPlayer.src !== '' && audioPlayer.src !== window.location.href) {
                     stationNameEl.textContent = "Prekid Strima";
                    stationGenreEl.textContent = "Izaberite drugu stanicu.";
                    updatePlayPauseUI(false);
                    currentStationIndex = -1;
                }
            });
            
            // Postavljanje listenera za dugmad tajmera
            for (var i = 0; i < timerButtons.length; i++) {
                timerButtons[i].addEventListener('click', function() {
                    startTimer(parseInt(this.getAttribute('data-minutes'), 10));
                });
            }
            cancelTimerBtn.addEventListener('click', cancelTimer);

            // --- Inicijalizacija Liste Stanica ---

            function initializeStationList() {
                for (var i = 0; i < stations.length; i++) {
                    var station = stations[i];
                    var stationDiv = document.createElement('div');
                    
                    // Koristimo clearfix za float-ove
                    stationDiv.className = 'station-item clearfix';
                    
                    // Koristimo jednostavan HTML za strukturu elementa
                    stationDiv.innerHTML =
                        '<img src="' + station.art + '" alt="' + station.name + '" class="station-art-small">' +
                        '<div class="station-info">' +
                            '<p>' + station.name + '</p>' +
                            '<p>' + station.genre + '</p>' +
                        '</div>';
                    
                    // Koristimo IFFE za kreiranje scope-a za index
                    (function(index) {
                        stationDiv.addEventListener('click', function() { 
                            playStation(index);
                        });
                    })(i);
                    
                    stationList.appendChild(stationDiv);
                }
            }

            // Inicijalno podesavanje
            initializeStationList();
            audioPlayer.volume = 0.8;
            updatePlayPauseUI(false); // Osiguravamo da je inicijalno stanje 'POKRENI'
        });
    </script>
</body>
</html>
